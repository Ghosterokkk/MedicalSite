<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Медицинский тест для сотрудников</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #1a73e8;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="email"],
        input[type="text"],
        input[type="number"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        textarea:focus {
            border-color: #1a73e8;
            outline: none;
        }
        
        .btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background-color: #0d62d9;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background-color: #5f6368;
        }
        
        .btn-secondary:hover {
            background-color: #4a4d52;
        }
        
        .btn-danger {
            background-color: #d93025;
        }
        
        .btn-danger:hover {
            background-color: #c5221f;
        }
        
        .btn-success {
            background-color: #0b8043;
        }
        
        .btn-success:hover {
            background-color: #096b38;
        }
        
        .test-section {
            display: none;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .option:hover {
            background-color: #f9f9f9;
        }
        
        .option.selected {
            background-color: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .option input {
            margin-right: 10px;
        }
        
        .results {
            text-align: center;
            padding: 30px;
        }
        
        .score {
            font-size: 24px;
            font-weight: 700;
            color: #1a73e8;
            margin: 20px 0;
        }
        
        .message {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: #d93025;
            font-size: 14px;
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .timer {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .timer.warning {
            background-color: #fce8e6;
            color: #d93025;
        }
        
        .question-timer {
            font-size: 14px;
            color: #5f6368;
            margin-bottom: 10px;
        }
        
        .admin-panel {
            display: none;
        }
        
        .question-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
        }
        
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-input input {
            flex: 1;
            margin-right: 10px;
        }
        
        .correct-option {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .correct-option select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #1a73e8;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .question-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .question-counter {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .time-expired {
            background-color: #fce8e6;
            border: 1px solid #f28b82;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .results-details {
            text-align: left;
            margin-top: 30px;
        }
        
        .result-item {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        
        .result-item.correct {
            border-left: 4px solid #0b8043;
        }
        
        .result-item.incorrect {
            border-left: 4px solid #d93025;
        }
        
        .result-item.unanswered {
            border-left: 4px solid #5f6368;
        }
        
        .result-question {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .result-answer {
            margin-bottom: 5px;
        }
        
        .correct-answer {
            color: #0b8043;
            font-weight: 600;
        }
        
        .user-answer {
            color: #1a73e8;
        }
        
        .incorrect-answer {
            color: #d93025;
            font-weight: 600;
        }
        
        .unanswered {
            color: #5f6368;
            font-style: italic;
        }
        
        .results-summary {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            color: #5f6368;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .admin-btn {
                position: static;
                margin-top: 10px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .question-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .results-summary {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Медицинский тест для сотрудников</h1>
            <p class="description">Пройдите тестирование для оценки ваших медицинских знаний. Введите ваш адрес Gmail для начала.</p>
            <button class="btn admin-btn" id="admin-toggle">Режим администратора</button>
        </header>
        
        <!-- Панель пользователя -->
        <div id="user-panel">
            <div class="card" id="login-section">
                <h2>Авторизация</h2>
                <p>Для прохождения теста введите ваш адрес электронной почты Gmail.</p>
                
                <div class="form-group">
                    <label for="email">Адрес Gmail</label>
                    <input type="email" id="email" placeholder="example@gmail.com" required>
                    <div class="error hidden" id="email-error">Пожалуйста, введите корректный адрес Gmail</div>
                </div>
                
                <button class="btn btn-block" id="start-test">Начать тест</button>
            </div>
            
            <div class="card test-section" id="test-section">
                <div class="timer" id="timer">Общее время: 30:00</div>
                <div class="question-counter" id="question-counter">Вопрос 1 из 3</div>
                
                <h2>Медицинский тест</h2>
                <p>Ответьте на все вопросы. После завершения вы увидите результаты.</p>
                
                <div id="questions-container">
                    <!-- Вопросы будут добавлены динамически -->
                </div>
                
                <div class="question-navigation">
                    <button class="btn btn-secondary" id="prev-question" disabled>Предыдущий вопрос</button>
                    <button class="btn" id="next-question">Следующий вопрос</button>
                </div>
                
                <button class="btn btn-block" id="submit-test" style="margin-top: 20px;">Завершить тест</button>
            </div>
            
            <div class="card test-section" id="results-section">
                <div class="results">
                    <h2>Результаты теста</h2>
                    <p class="message" id="result-message"></p>
                    <div class="score" id="score"></div>
                    <p>Результаты отправлены на ваш email: <span id="user-email"></span></p>
                    
                    <div class="results-summary" id="results-summary">
                        <!-- Сводка результатов будет добавлена динамически -->
                    </div>
                    
                    <div class="results-details" id="results-details">
                        <!-- Детали результатов будут добавлены динамически -->
                    </div>
                    
                    <button class="btn" id="restart-test">Пройти тест снова</button>
                </div>
            </div>
        </div>
        
        <!-- Админ-панель -->
        <div class="admin-panel" id="admin-panel">
            <div class="card" id="admin-login">
                <h2>Вход для администратора</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label for="admin-username">Логин</label>
                        <input type="text" id="admin-username" placeholder="Введите логин">
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">Пароль</label>
                        <input type="password" id="admin-password" placeholder="Введите пароль">
                    </div>
                    
                    <div class="error hidden" id="admin-login-error">Неверный логин или пароль</div>
                    
                    <button class="btn btn-block" id="admin-login-btn">Войти</button>
                </div>
            </div>
            
            <div class="admin-content hidden" id="admin-content">
                <div class="tabs">
                    <div class="tab active" data-tab="questions">Управление вопросами</div>
                    <div class="tab" data-tab="settings">Настройки времени</div>
                </div>
                
                <div class="tab-content active" id="questions-tab">
                    <div class="card">
                        <h2>Управление вопросами</h2>
                        <p>Добавляйте, редактируйте и удаляйте вопросы теста.</p>
                        
                        <div class="form-group">
                            <button class="btn" id="add-question">Добавить вопрос</button>
                        </div>
                        
                        <div id="questions-list">
                            <!-- Список вопросов будет добавлен динамически -->
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="settings-tab">
                    <div class="card">
                        <h2>Настройки времени</h2>
                        <p>Установите общее время теста и время на каждый вопрос.</p>
                        
                        <div class="form-group">
                            <label for="total-time">Общее время теста (минуты)</label>
                            <input type="number" id="total-time" min="1" value="30">
                        </div>
                        
                        <button class="btn btn-block" id="save-settings">Сохранить настройки</button>
                    </div>
                </div>
                
                <div class="card">
                    <button class="btn btn-secondary btn-block" id="user-mode">Вернуться в режим пользователя</button>
                    <button class="btn btn-danger btn-block" id="admin-logout" style="margin-top: 10px;">Выйти из админ-панели</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Система Тестирования Медицинского Корпуса © 2025</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Элементы DOM
            const userPanel = document.getElementById('user-panel');
            const adminPanel = document.getElementById('admin-panel');
            const adminToggle = document.getElementById('admin-toggle');
            const userModeBtn = document.getElementById('user-mode');
            
            const loginSection = document.getElementById('login-section');
            const testSection = document.getElementById('test-section');
            const resultsSection = document.getElementById('results-section');
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            const startTestBtn = document.getElementById('start-test');
            const submitTestBtn = document.getElementById('submit-test');
            const restartTestBtn = document.getElementById('restart-test');
            const questionsContainer = document.getElementById('questions-container');
            const resultMessage = document.getElementById('result-message');
            const scoreElement = document.getElementById('score');
            const userEmailElement = document.getElementById('user-email');
            const timerElement = document.getElementById('timer');
            const questionCounter = document.getElementById('question-counter');
            const prevQuestionBtn = document.getElementById('prev-question');
            const nextQuestionBtn = document.getElementById('next-question');
            const resultsSummary = document.getElementById('results-summary');
            const resultsDetails = document.getElementById('results-details');
            
            // Элементы админ-панели
            const adminLogin = document.getElementById('admin-login');
            const adminContent = document.getElementById('admin-content');
            const adminUsername = document.getElementById('admin-username');
            const adminPassword = document.getElementById('admin-password');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminLoginError = document.getElementById('admin-login-error');
            const adminLogoutBtn = document.getElementById('admin-logout');
            
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const addQuestionBtn = document.getElementById('add-question');
            const questionsList = document.getElementById('questions-list');
            const totalTimeInput = document.getElementById('total-time');
            const saveSettingsBtn = document.getElementById('save-settings');
            
            // Данные приложения
            let userAnswers = [];
            let userEmail = "";
            let totalTime = 30 * 60; // 30 минут в секундах
            let timerInterval;
            let currentQuestionIndex = 0;
            let questionTimers = [];
            let currentQuestionTimer;
            
            // Учетные данные администратора (в реальном приложении должны храниться на сервере)
            const adminCredentials = {
                username: "admin",
                password: "admin123"
            };
            
            // Вопросы для теста (по умолчанию)
            let questions = JSON.parse(localStorage.getItem('medicalTestQuestions')) || [
                {
                    id: 1,
                    question: "Каков нормальный показатель артериального давления у взрослого человека?",
                    options: [
                        "120/80 мм рт.ст.",
                        "140/90 мм рт.ст.",
                        "100/60 мм рт.ст.",
                        "130/85 мм рт.ст."
                    ],
                    correct: 0,
                    time: 60 // время в секундах
                },
                {
                    id: 2,
                    question: "Какой витамин вырабатывается в коже под воздействием солнечного света?",
                    options: [
                        "Витамин А",
                        "Витамин С",
                        "Витамин D",
                        "Витамин Е"
                    ],
                    correct: 2,
                    time: 45
                },
                {
                    id: 3,
                    question: "Какой орган отвечает за фильтрацию крови и выработку мочи?",
                    options: [
                        "Печень",
                        "Сердце",
                        "Почки",
                        "Легкие"
                    ],
                    correct: 2,
                    time: 75
                }
            ];
            
            // Загрузка настроек времени
            const savedSettings = JSON.parse(localStorage.getItem('medicalTestSettings'));
            if (savedSettings) {
                totalTime = savedSettings.totalTime * 60;
                totalTimeInput.value = savedSettings.totalTime;
            }
            
            // Инициализация админ-панели
            function initAdminPanel() {
                renderQuestionsList();
                
                // Обработчики вкладок
                tabs.forEach(tab => {
                    tab.addEventListener('click', function() {
                        const tabId = this.getAttribute('data-tab');
                        
                        tabs.forEach(t => t.classList.remove('active'));
                        this.classList.add('active');
                        
                        tabContents.forEach(content => {
                            content.classList.remove('active');
                            if (content.id === `${tabId}-tab`) {
                                content.classList.add('active');
                            }
                        });
                    });
                });
                
                // Добавление вопроса
                addQuestionBtn.addEventListener('click', function() {
                    const newId = questions.length > 0 ? Math.max(...questions.map(q => q.id)) + 1 : 1;
                    questions.push({
                        id: newId,
                        question: "Новый вопрос",
                        options: ["Вариант 1", "Вариант 2", "Вариант 3", "Вариант 4"],
                        correct: 0,
                        time: 60
                    });
                    saveQuestions();
                    renderQuestionsList();
                });
                
                // Сохранение настроек
                saveSettingsBtn.addEventListener('click', function() {
                    const totalTimeMinutes = parseInt(totalTimeInput.value);
                    
                    if (totalTimeMinutes) {
                        totalTime = totalTimeMinutes * 60;
                        
                        localStorage.setItem('medicalTestSettings', JSON.stringify({
                            totalTime: totalTimeMinutes
                        }));
                        
                        alert('Настройки времени сохранены!');
                    } else {
                        alert('Пожалуйста, введите корректное значение времени.');
                    }
                });
            }
            
            // Отрисовка списка вопросов в админ-панели
            function renderQuestionsList() {
                questionsList.innerHTML = '';
                
                questions.forEach((question, index) => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'question-item';
                    questionItem.innerHTML = `
                        <div class="question-header">
                            <h3>Вопрос ${index + 1} (Время: ${question.time} сек.)</h3>
                            <div class="question-actions">
                                <button class="btn btn-secondary edit-question" data-id="${question.id}">Редактировать</button>
                                <button class="btn btn-danger delete-question" data-id="${question.id}">Удалить</button>
                            </div>
                        </div>
                        <p>${question.question}</p>
                        <div class="options">
                            ${question.options.map((option, optIndex) => `
                                <div>${optIndex + 1}. ${option} ${optIndex === question.correct ? '(правильный)' : ''}</div>
                            `).join('')}
                        </div>
                    `;
                    
                    questionsList.appendChild(questionItem);
                });
                
                // Обработчики для кнопок редактирования и удаления
                document.querySelectorAll('.edit-question').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const questionId = parseInt(this.getAttribute('data-id'));
                        editQuestion(questionId);
                    });
                });
                
                document.querySelectorAll('.delete-question').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const questionId = parseInt(this.getAttribute('data-id'));
                        deleteQuestion(questionId);
                    });
                });
            }
            
            // Редактирование вопроса
            function editQuestion(questionId) {
                const question = questions.find(q => q.id === questionId);
                if (!question) return;
                
                const questionItem = document.querySelector(`.edit-question[data-id="${questionId}"]`).closest('.question-item');
                
                questionItem.innerHTML = `
                    <div class="form-group">
                        <label>Текст вопроса</label>
                        <textarea class="question-text">${question.question}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>Время на вопрос (секунды)</label>
                        <input type="number" class="question-time" value="${question.time}" min="10">
                    </div>
                    
                    <div class="form-group">
                        <label>Варианты ответов</label>
                        ${question.options.map((option, index) => `
                            <div class="option-input">
                                <input type="text" class="option-text" value="${option}" placeholder="Вариант ${index + 1}">
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="correct-option">
                        <label>Правильный ответ:</label>
                        <select class="correct-answer">
                            ${question.options.map((_, index) => `
                                <option value="${index}" ${index === question.correct ? 'selected' : ''}>Вариант ${index + 1}</option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div class="question-actions" style="margin-top: 15px;">
                        <button class="btn save-question" data-id="${questionId}">Сохранить</button>
                        <button class="btn btn-secondary cancel-edit" data-id="${questionId}">Отмена</button>
                    </div>
                `;
                
                // Обработчики для кнопок сохранения и отмены
                questionItem.querySelector('.save-question').addEventListener('click', function() {
                    const updatedQuestion = questionItem.querySelector('.question-text').value;
                    const questionTime = parseInt(questionItem.querySelector('.question-time').value);
                    const optionInputs = questionItem.querySelectorAll('.option-text');
                    const correctAnswer = parseInt(questionItem.querySelector('.correct-answer').value);
                    
                    const updatedOptions = Array.from(optionInputs).map(input => input.value);
                    
                    // Обновление вопроса
                    question.question = updatedQuestion;
                    question.time = questionTime;
                    question.options = updatedOptions;
                    question.correct = correctAnswer;
                    
                    saveQuestions();
                    renderQuestionsList();
                });
                
                questionItem.querySelector('.cancel-edit').addEventListener('click', function() {
                    renderQuestionsList();
                });
            }
            
            // Удаление вопроса
            function deleteQuestion(questionId) {
                if (confirm('Вы уверены, что хотите удалить этот вопрос?')) {
                    questions = questions.filter(q => q.id !== questionId);
                    saveQuestions();
                    renderQuestionsList();
                }
            }
            
            // Сохранение вопросов в localStorage
            function saveQuestions() {
                localStorage.setItem('medicalTestQuestions', JSON.stringify(questions));
            }
            
            // Инициализация теста
            function initTest() {
                questionsContainer.innerHTML = '';
                userAnswers = [];
                currentQuestionIndex = 0;
                questionTimers = [];
                
                // Создаем таймеры для каждого вопроса
                questions.forEach(question => {
                    questionTimers.push({
                        timeLeft: question.time,
                        timer: null
                    });
                });
                
                // Показываем первый вопрос
                showQuestion(currentQuestionIndex);
                
                // Запускаем общий таймер
                startTotalTimer();
            }
            
            // Показать вопрос
            function showQuestion(index) {
                questionsContainer.innerHTML = '';
                questionCounter.textContent = `Вопрос ${index + 1} из ${questions.length}`;
                
                const question = questions[index];
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                
                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.textContent = `${index + 1}. ${question.question}`;
                
                const questionTimer = document.createElement('div');
                questionTimer.className = 'question-timer';
                questionTimer.id = 'current-question-timer';
                questionTimer.textContent = `Время на вопрос: ${formatTime(questionTimers[index].timeLeft)}`;
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options';
                
                question.options.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('label');
                    optionElement.className = 'option';
                    if (userAnswers[index] === optionIndex) {
                        optionElement.classList.add('selected');
                    }
                    
                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = `question-${index}`;
                    radioInput.value = optionIndex;
                    radioInput.checked = userAnswers[index] === optionIndex;
                    
                    radioInput.addEventListener('change', function() {
                        userAnswers[index] = optionIndex;
                        // Добавляем визуальное выделение выбранного варианта
                        const allOptions = optionsContainer.querySelectorAll('.option');
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        optionElement.classList.add('selected');
                        
                        // Разрешаем переход к следующему вопросу
                        if (index < questions.length - 1) {
                            nextQuestionBtn.disabled = false;
                        }
                    });
                    
                    const optionText = document.createElement('span');
                    optionText.textContent = option;
                    
                    optionElement.appendChild(radioInput);
                    optionElement.appendChild(optionText);
                    optionsContainer.appendChild(optionElement);
                });
                
                questionElement.appendChild(questionTimer);
                questionElement.appendChild(questionText);
                questionElement.appendChild(optionsContainer);
                questionsContainer.appendChild(questionElement);
                
                // Обновляем кнопки навигации
                prevQuestionBtn.disabled = index === 0;
                nextQuestionBtn.disabled = index === questions.length - 1 || userAnswers[index] === undefined;
                
                // Запускаем таймер для текущего вопроса
                startQuestionTimer(index);
            }
            
            // Запуск общего таймера
            function startTotalTimer() {
                let timeLeft = totalTime;
                updateTimerDisplay(timeLeft);
                
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay(timeLeft);
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timeExpired();
                    }
                }, 1000);
            }
            
            // Запуск таймера для вопроса
            function startQuestionTimer(questionIndex) {
                // Останавливаем предыдущий таймер вопроса
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                const questionTimer = questionTimers[questionIndex];
                const questionTime = questions[questionIndex].time;
                
                // Если время уже истекло, переходим к следующему вопросу
                if (questionTimer.timeLeft <= 0) {
                    if (questionIndex < questions.length - 1) {
                        nextQuestion();
                    } else {
                        submitTest();
                    }
                    return;
                }
                
                currentQuestionTimer = setInterval(() => {
                    questionTimer.timeLeft--;
                    updateQuestionTimerDisplay(questionTimer.timeLeft);
                    
                    if (questionTimer.timeLeft <= 0) {
                        clearInterval(currentQuestionTimer);
                        // Если время истекло, переходим к следующему вопросу
                        if (questionIndex < questions.length - 1) {
                            nextQuestion();
                        } else {
                            submitTest();
                        }
                    }
                }, 1000);
            }
            
            // Обновление отображения общего таймера
            function updateTimerDisplay(seconds) {
                timerElement.textContent = `Общее время: ${formatTime(seconds)}`;
                
                if (seconds <= 300) { // 5 минут
                    timerElement.classList.add('warning');
                } else {
                    timerElement.classList.remove('warning');
                }
            }
            
            // Обновление отображения таймера вопроса
            function updateQuestionTimerDisplay(seconds) {
                const questionTimer = document.getElementById('current-question-timer');
                if (questionTimer) {
                    questionTimer.textContent = `Время на вопрос: ${formatTime(seconds)}`;
                    
                    if (seconds <= 10) {
                        questionTimer.style.color = '#d93025';
                    } else {
                        questionTimer.style.color = '#5f6368';
                    }
                }
            }
            
            // Переход к следующему вопросу
            function nextQuestion() {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }
            }
            
            // Переход к предыдущему вопросу
            function prevQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion(currentQuestionIndex);
                }
            }
            
            // Истекло время теста
            function timeExpired() {
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                // Останавливаем все таймеры вопросов
                questionTimers.forEach(timer => {
                    if (timer.timer) {
                        clearInterval(timer.timer);
                    }
                });
                
                // Показываем сообщение об истечении времени
                const timeExpiredMsg = document.createElement('div');
                timeExpiredMsg.className = 'time-expired';
                timeExpiredMsg.innerHTML = `
                    <h3>Время вышло!</h3>
                    <p>К сожалению, вы не успели завершить тест в отведенное время.</p>
                    <p>Тест считается проваленным.</p>
                `;
                
                testSection.insertBefore(timeExpiredMsg, testSection.firstChild);
                
                // Отправляем тест с провальным результатом
                setTimeout(() => {
                    submitTest(true);
                }, 3000);
            }
            
            // Форматирование времени
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // Проверка email
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email) && email.includes('gmail.com');
            }
            
            // Начало теста
            startTestBtn.addEventListener('click', function() {
                const email = emailInput.value.trim();
                
                if (!isValidEmail(email)) {
                    emailError.classList.remove('hidden');
                    return;
                }
                
                emailError.classList.add('hidden');
                userEmail = email;
                userEmailElement.textContent = email;
                
                loginSection.classList.add('hidden');
                testSection.classList.remove('test-section');
                initTest();
            });
            
            // Отображение детальных результатов
            function showDetailedResults(correctAnswers, answeredQuestions, timeExpired = false) {
                resultsSummary.innerHTML = '';
                resultsDetails.innerHTML = '';
                
                // Сводка результатов
                resultsSummary.innerHTML = `
                    <div class="summary-item">
                        <div class="summary-value">${questions.length}</div>
                        <div class="summary-label">Всего вопросов</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${answeredQuestions}</div>
                        <div class="summary-label">Отвечено</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${correctAnswers}</div>
                        <div class="summary-label">Правильно</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${questions.length - answeredQuestions}</div>
                        <div class="summary-label">Пропущено</div>
                    </div>
                `;
                
                // Детали по каждому вопросу
                questions.forEach((question, index) {
                    const resultItem = document.createElement('div');
                    const userAnswer = userAnswers[index];
                    const isCorrect = userAnswer === question.correct;
                    const isAnswered = userAnswer !== undefined;
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    if (!isAnswered) {
                        statusClass = 'unanswered';
                        statusText = 'Вопрос без ответа';
                    } else if (isCorrect) {
                        statusClass = 'correct';
                        statusText = 'Правильно';
                    } else {
                        statusClass = 'incorrect';
                        statusText = 'Неправильно';
                    }
                    
                    resultItem.className = `result-item ${statusClass}`;
                    resultItem.innerHTML = `
                        <div class="result-question">${index + 1}. ${question.question}</div>
                        <div class="result-answer">
                            <span class="user-answer">Ваш ответ: </span>
                            ${isAnswered ? question.options[userAnswer] : '<span class="unanswered">Не ответили</span>'}
                            ${!isAnswered ? '' : (isCorrect ? ' <span class="correct-answer">✓</span>' : ' <span class="incorrect-answer">✗</span>')}
                        </div>
                        ${!isCorrect && isAnswered ? `
                            <div class="result-answer">
                                <span class="correct-answer">Правильный ответ: ${question.options[question.correct]}</span>
                            </div>
                        ` : ''}
                        <div style="margin-top: 8px; font-size: 14px; color: #5f6368;">
                            ${statusText}
                        </div>
                    `;
                    
                    resultsDetails.appendChild(resultItem);
                });
            }
            
            // Отправка теста
            function submitTest(timeExpired = false) {
                // Остановка таймеров
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                // Подсчет результатов
                let correctAnswers = 0;
                let answeredQuestions = 0;
                
                userAnswers.forEach((answer, index) => {
                    if (answer !== undefined) {
                        answeredQuestions++;
                        if (answer === questions[index].correct) {
                            correctAnswers++;
                        }
                    }
                });
                
                const score = timeExpired ? 0 : Math.round((correctAnswers / questions.length) * 100);
                
                // Отображение результатов
                testSection.classList.add('test-section');
                resultsSection.classList.remove('test-section');
                
                scoreElement.textContent = `${score}%`;
                
                if (timeExpired) {
                    resultMessage.textContent = 'Время вышло! Тест не пройден.';
                } else if (score >= 80) {
                    resultMessage.textContent = 'Отличный результат! Вы показали высокий уровень медицинских знаний.';
                } else if (score >= 60) {
                    resultMessage.textContent = 'Хороший результат! Ваши медицинские знания на достаточном уровне.';
                } else {
                    resultMessage.textContent = 'Рекомендуется дополнительное обучение для улучшения медицинских знаний.';
                }
                
                // Показываем детальные результаты
                showDetailedResults(correctAnswers, answeredQuestions, timeExpired);
                
                // В реальном приложении здесь был бы код для отправки результатов на email
                console.log(`Результаты теста отправлены на ${userEmail}: ${score}% правильных ответов`);
            }
            
            submitTestBtn.addEventListener('click', () => submitTest());
            
            // Перезапуск теста
            restartTestBtn.addEventListener('click', function() {
                resultsSection.classList.add('test-section');
                loginSection.classList.remove('hidden');
                emailInput.value = '';
                
                // Остановка таймеров
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
            });
            
            // Обработчики навигации по вопросам
            nextQuestionBtn.addEventListener('click', nextQuestion);
            prevQuestionBtn.addEventListener('click', prevQuestion);
            
            // Переключение между режимами пользователя и администратора
            adminToggle.addEventListener('click', function() {
                userPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                adminLogin.classList.remove('hidden');
                adminContent.classList.add('hidden');
            });
            
            userModeBtn.addEventListener('click', function() {
                adminPanel.style.display = 'none';
                userPanel.style.display = 'block';
            });
            
            // Вход в админ-панель
            adminLoginBtn.addEventListener('click', function() {
                const username = adminUsername.value.trim();
                const password = adminPassword.value.trim();
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    adminLoginError.classList.add('hidden');
                    adminLogin.classList.add('hidden');
                    adminContent.classList.remove('hidden');
                } else {
                    adminLoginError.classList.remove('hidden');
                }
            });
            
            // Выход из админ-панели
            adminLogoutBtn.addEventListener('click', function() {
                adminLogin.classList.remove('hidden');
                adminContent.classList.add('hidden');
                adminUsername.value = '';
                adminPassword.value = '';
            });
            
            // Инициализация админ-панели
            initAdminPanel();
        });
    </script>
</body>
</html>
