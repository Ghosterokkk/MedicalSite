<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ç–µ—Å—Ç –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: #1a73e8;
            color: white;
            padding: 20px 0;
            text-align: center;
            border-radius: 8px 8px 0 0;
            margin-bottom: 20px;
            position: relative;
        }
        
        h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 16px;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="email"],
        input[type="text"],
        input[type="number"],
        input[type="password"],
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            transition: border-color 0.3s;
        }
        
        input:focus,
        textarea:focus {
            border-color: #1a73e8;
            outline: none;
        }
        
        .btn {
            background-color: #1a73e8;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: background-color 0.3s;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background-color: #0d62d9;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .btn-secondary {
            background-color: #5f6368;
        }
        
        .btn-secondary:hover {
            background-color: #4a4d52;
        }
        
        .btn-danger {
            background-color: #d93025;
        }
        
        .btn-danger:hover {
            background-color: #c5221f;
        }
        
        .btn-success {
            background-color: #0b8043;
        }
        
        .btn-success:hover {
            background-color: #096b38;
        }
        
        .test-section {
            display: none;
        }
        
        .question {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        
        .question:last-child {
            border-bottom: none;
        }
        
        .question-text {
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .option {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .option:hover {
            background-color: #f9f9f9;
        }
        
        .option.selected {
            background-color: #e8f0fe;
            border-color: #1a73e8;
        }
        
        .option input {
            margin-right: 10px;
        }
        
        .results {
            text-align: center;
            padding: 30px;
        }
        
        .score {
            font-size: 24px;
            font-weight: 700;
            color: #1a73e8;
            margin: 20px 0;
        }
        
        .message {
            font-size: 18px;
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .error {
            color: #d93025;
            font-size: 14px;
            margin-top: 5px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 14px;
        }
        
        .admin-btn {
            position: absolute;
            top: 20px;
            right: 20px;
        }
        
        .timer {
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        
        .timer.warning {
            background-color: #fce8e6;
            color: #d93025;
        }
        
        .question-timer {
            font-size: 14px;
            color: #5f6368;
            margin-bottom: 10px;
        }
        
        .admin-panel {
            display: none;
        }
        
        .question-item {
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f8f9fa;
        }
        
        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .question-actions {
            display: flex;
            gap: 10px;
        }
        
        .option-input {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .option-input input {
            flex: 1;
            margin-right: 10px;
        }
        
        .correct-option {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }
        
        .correct-option select {
            padding: 8px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #1a73e8;
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .question-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .question-counter {
            text-align: center;
            margin-bottom: 15px;
            font-weight: 600;
        }
        
        .login-form {
            max-width: 400px;
            margin: 0 auto;
        }
        
        .time-expired {
            background-color: #fce8e6;
            border: 1px solid #f28b82;
            padding: 20px;
            border-radius: 4px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .results-details {
            text-align: left;
            margin-top: 30px;
        }
        
        .result-item {
            margin-bottom: 25px;
            padding: 15px;
            border-radius: 4px;
            background-color: #f8f9fa;
        }
        
        .result-item.correct {
            border-left: 4px solid #0b8043;
        }
        
        .result-item.incorrect {
            border-left: 4px solid #d93025;
        }
        
        .result-item.unanswered {
            border-left: 4px solid #5f6368;
        }
        
        .result-question {
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .result-answer {
            margin-bottom: 5px;
        }
        
        .correct-answer {
            color: #0b8043;
            font-weight: 600;
        }
        
        .user-answer {
            color: #1a73e8;
        }
        
        .incorrect-answer {
            color: #d93025;
            font-weight: 600;
        }
        
        .unanswered {
            color: #5f6368;
            font-style: italic;
        }
        
        .results-summary {
            display: flex;
            justify-content: space-around;
            margin: 30px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .summary-item {
            text-align: center;
        }
        
        .summary-value {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .summary-label {
            font-size: 14px;
            color: #5f6368;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 10px;
            }
            
            .card {
                padding: 20px;
            }
            
            .admin-btn {
                position: static;
                margin-top: 10px;
            }
            
            .question-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .question-actions {
                margin-top: 10px;
                width: 100%;
                justify-content: space-between;
            }
            
            .results-summary {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ç–µ—Å—Ç –¥–ª—è —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h1>
            <p class="description">–ü—Ä–æ–π–¥–∏—Ç–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ü–µ–Ω–∫–∏ –≤–∞—à–∏—Ö –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–Ω–∞–Ω–∏–π. –í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å Gmail –¥–ª—è –Ω–∞—á–∞–ª–∞.</p>
            <button class="btn admin-btn" id="admin-toggle">–†–µ–∂–∏–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</button>
        </header>
        
        <!-- –ü–∞–Ω–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
        <div id="user-panel">
            <div class="card" id="login-section">
                <h2>–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h2>
                <p>–î–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞ –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã Gmail.</p>
                
                <div class="form-group">
                    <label for="email">–ê–¥—Ä–µ—Å Gmail</label>
                    <input type="email" id="email" placeholder="example@gmail.com" required>
                    <div class="error hidden" id="email-error">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∞–¥—Ä–µ—Å Gmail</div>
                </div>
                
                <button class="btn btn-block" id="start-test">–ù–∞—á–∞—Ç—å —Ç–µ—Å—Ç</button>
            </div>
            
            <div class="card test-section" id="test-section">
                <div class="timer" id="timer">–û–±—â–µ–µ –≤—Ä–µ–º—è: 30:00</div>
                <div class="question-counter" id="question-counter">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 3</div>
                
                <h2>–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π —Ç–µ—Å—Ç</h2>
                <p>–û—Ç–≤–µ—Ç—å—Ç–µ –Ω–∞ –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –≤—ã —É–≤–∏–¥–∏—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.</p>
                
                <div id="questions-container">
                    <!-- –í–æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                
                <div class="question-navigation">
                    <button class="btn btn-secondary" id="prev-question" disabled>–ü—Ä–µ–¥—ã–¥—É—â–∏–π –≤–æ–ø—Ä–æ—Å</button>
                    <button class="btn" id="next-question">–°–ª–µ–¥—É—é—â–∏–π –≤–æ–ø—Ä–æ—Å</button>
                </div>
                
                <button class="btn btn-block" id="submit-test" style="margin-top: 20px;">–ó–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç</button>
            </div>
            
            <div class="card test-section" id="results-section">
                <div class="results">
                    <h2>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞</h2>
                    <p class="message" id="result-message"></p>
                    <div class="score" id="score"></div>
                    <p>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à email: <span id="user-email"></span></p>
                    
                    <div class="results-summary" id="results-summary">
                        <!-- –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <div class="results-details" id="results-details">
                        <!-- –î–µ—Ç–∞–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    
                    <button class="btn" id="restart-test">–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç —Å–Ω–æ–≤–∞</button>
                </div>
            </div>
        </div>
        
        <!-- –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å -->
        <div class="admin-panel" id="admin-panel">
            <div class="card" id="admin-login">
                <h2>–í—Ö–æ–¥ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</h2>
                <div class="login-form">
                    <div class="form-group">
                        <label for="admin-username">–õ–æ–≥–∏–Ω</label>
                        <input type="text" id="admin-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                    </div>
                    
                    <div class="form-group">
                        <label for="admin-password">–ü–∞—Ä–æ–ª—å</label>
                        <input type="password" id="admin-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                    </div>
                    
                    <div class="error hidden" id="admin-login-error">–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å</div>
                    
                    <button class="btn btn-block" id="admin-login-btn">–í–æ–π—Ç–∏</button>
                </div>
            </div>
            
            <div class="admin-content hidden" id="admin-content">
                <div class="tabs">
                    <div class="tab active" data-tab="questions">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</div>
                    <div class="tab" data-tab="settings">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏</div>
                </div>
                
                <div class="tab-content active" id="questions-tab">
                    <div class="card">
                        <h2>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞–º–∏</h2>
                        <p>–î–æ–±–∞–≤–ª—è–π—Ç–µ, —Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∏ —É–¥–∞–ª—è–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã —Ç–µ—Å—Ç–∞.</p>
                        
                        <div class="form-group">
                            <button class="btn" id="add-question">–î–æ–±–∞–≤–∏—Ç—å –≤–æ–ø—Ä–æ—Å</button>
                        </div>
                        
                        <div id="questions-list">
                            <!-- –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                        </div>
                    </div>
                </div>
                
                <div class="tab-content" id="settings-tab">
                    <div class="card">
                        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Ä–µ–º–µ–Ω–∏</h2>
                        <p>–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –æ–±—â–µ–µ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ –∏ –≤—Ä–µ–º—è –Ω–∞ –∫–∞–∂–¥—ã–π –≤–æ–ø—Ä–æ—Å.</p>
                        
                        <div class="form-group">
                            <label for="total-time">–û–±—â–µ–µ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞ (–º–∏–Ω—É—Ç—ã)</label>
                            <input type="number" id="total-time" min="1" value="30">
                        </div>
                        
                        <button class="btn btn-block" id="save-settings">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                    </div>
                </div>
                
                <div class="card">
                    <button class="btn btn-secondary btn-block" id="user-mode">–í–µ—Ä–Ω—É—Ç—å—Å—è –≤ —Ä–µ–∂–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</button>
                    <button class="btn btn-danger btn-block" id="admin-logout" style="margin-top: 10px;">–í—ã–π—Ç–∏ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>–°–∏—Å—Ç–µ–º–∞ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–æ–≥–æ –ö–æ—Ä–ø—É—Å–∞ ¬© 2025</p>
        </footer>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
            const userPanel = document.getElementById('user-panel');
            const adminPanel = document.getElementById('admin-panel');
            const adminToggle = document.getElementById('admin-toggle');
            const userModeBtn = document.getElementById('user-mode');
            
            const loginSection = document.getElementById('login-section');
            const testSection = document.getElementById('test-section');
            const resultsSection = document.getElementById('results-section');
            const emailInput = document.getElementById('email');
            const emailError = document.getElementById('email-error');
            const startTestBtn = document.getElementById('start-test');
            const submitTestBtn = document.getElementById('submit-test');
            const restartTestBtn = document.getElementById('restart-test');
            const questionsContainer = document.getElementById('questions-container');
            const resultMessage = document.getElementById('result-message');
            const scoreElement = document.getElementById('score');
            const userEmailElement = document.getElementById('user-email');
            const timerElement = document.getElementById('timer');
            const questionCounter = document.getElementById('question-counter');
            const prevQuestionBtn = document.getElementById('prev-question');
            const nextQuestionBtn = document.getElementById('next-question');
            const resultsSummary = document.getElementById('results-summary');
            const resultsDetails = document.getElementById('results-details');
            
            // –≠–ª–µ–º–µ–Ω—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            const adminLogin = document.getElementById('admin-login');
            const adminContent = document.getElementById('admin-content');
            const adminUsername = document.getElementById('admin-username');
            const adminPassword = document.getElementById('admin-password');
            const adminLoginBtn = document.getElementById('admin-login-btn');
            const adminLoginError = document.getElementById('admin-login-error');
            const adminLogoutBtn = document.getElementById('admin-logout');
            
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const addQuestionBtn = document.getElementById('add-question');
            const questionsList = document.getElementById('questions-list');
            const totalTimeInput = document.getElementById('total-time');
            const saveSettingsBtn = document.getElementById('save-settings');
            
            // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
            let userAnswers = [];
            let userEmail = "";
            let totalTime = 30 * 60; // 30 –º–∏–Ω—É—Ç –≤ —Å–µ–∫—É–Ω–¥–∞—Ö
            let timerInterval;
            let currentQuestionIndex = 0;
            let questionTimers = [];
            let currentQuestionTimer;
            
            // –£—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            const adminCredentials = {
                username: "admin",
                password: "admin123"
            };

            // üî• –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE - –ó–ê–ú–ï–ù–ò–¢–ï –ù–ê –í–ê–®–£! üî•
            const firebaseConfig = {
                apiKey: "–í–ê–®_API_KEY",
                authDomain: "–í–ê–®_PROJECT.firebaseapp.com",
                projectId: "–í–ê–®_PROJECT_ID",
                storageBucket: "–í–ê–®_PROJECT.appspot.com",
                messagingSenderId: "–í–ê–®_SENDER_ID",
                appId: "–í–ê–®_APP_ID"
            };

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            let db;
            try {
                firebase.initializeApp(firebaseConfig);
                db = firebase.firestore();
                console.log("Firebase initialized successfully");
            } catch (error) {
                console.error("Firebase initialization error:", error);
            }

            // Firebase —Ñ—É–Ω–∫—Ü–∏–∏
            async function loadQuestions() {
                try {
                    if (!db) {
                        console.log("Firebase not available, using local storage");
                        return getLocalQuestions();
                    }

                    console.log("Loading questions from Firebase...");
                    const snapshot = await db.collection('questions').orderBy('order').get();
                    
                    if (snapshot.empty) {
                        console.log("No questions found, creating default ones...");
                        await createDefaultQuestions();
                        return getDefaultQuestions();
                    }
                    
                    const questions = snapshot.docs.map(doc => {
                        const data = doc.data();
                        return {
                            id: doc.id,
                            question: data.question,
                            options: data.options,
                            correct: data.correct,
                            time: data.time || 60
                        };
                    });
                    
                    console.log("Loaded questions:", questions.length);
                    return questions;
                } catch (error) {
                    console.error('Error loading questions from Firebase:', error);
                    return getLocalQuestions();
                }
            }

            async function saveQuestions(questions) {
                try {
                    if (!db) {
                        console.log("Firebase not available, saving to local storage");
                        saveToLocalStorage(questions);
                        return questions;
                    }

                    console.log("Saving questions to Firebase...");
                    const batch = db.batch();
                    
                    // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                    const oldQuestions = await db.collection('questions').get();
                    oldQuestions.docs.forEach(doc => {
                        batch.delete(doc.ref);
                    });
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                    questions.forEach((question, index) => {
                        const ref = db.collection('questions').doc();
                        batch.set(ref, {
                            question: question.question,
                            options: question.options,
                            correct: question.correct,
                            time: question.time,
                            order: index
                        });
                    });
                    
                    await batch.commit();
                    console.log("Questions saved successfully to Firebase");
                    
                    // –¢–∞–∫–∂–µ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ backup
                    saveToLocalStorage(questions);
                    return questions;
                } catch (error) {
                    console.error('Error saving questions to Firebase:', error);
                    saveToLocalStorage(questions);
                    return questions;
                }
            }

            async function loadSettings() {
                try {
                    if (!db) {
                        return getLocalSettings();
                    }

                    const doc = await db.collection('settings').doc('main').get();
                    if (doc.exists) {
                        return doc.data();
                    } else {
                        const defaultSettings = { totalTime: 30 };
                        await db.collection('settings').doc('main').set(defaultSettings);
                        return defaultSettings;
                    }
                } catch (error) {
                    console.error('Error loading settings from Firebase:', error);
                    return getLocalSettings();
                }
            }

            async function saveSettings(settings) {
                try {
                    if (!db) {
                        saveSettingsToLocal(settings);
                        return settings;
                    }

                    await db.collection('settings').doc('main').set(settings);
                    saveSettingsToLocal(settings);
                    return settings;
                } catch (error) {
                    console.error('Error saving settings to Firebase:', error);
                    saveSettingsToLocal(settings);
                    return settings;
                }
            }

            // –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∫–∞–∫ fallback
            function getLocalQuestions() {
                const localQuestions = JSON.parse(localStorage.getItem('medicalTestQuestions'));
                return localQuestions || getDefaultQuestions();
            }

            function saveToLocalStorage(questions) {
                localStorage.setItem('medicalTestQuestions', JSON.stringify(questions));
            }

            function getLocalSettings() {
                const localSettings = JSON.parse(localStorage.getItem('medicalTestSettings'));
                return localSettings || { totalTime: 30 };
            }

            function saveSettingsToLocal(settings) {
                localStorage.setItem('medicalTestSettings', JSON.stringify(settings));
            }

            async function createDefaultQuestions() {
                const defaultQuestions = getDefaultQuestions();
                await saveQuestions(defaultQuestions);
            }

            function getDefaultQuestions() {
                return [
                    {
                        id: 'default1',
                        question: "–ö–∞–∫–æ–≤ –Ω–æ—Ä–º–∞–ª—å–Ω—ã–π –ø–æ–∫–∞–∑–∞—Ç–µ–ª—å –∞—Ä—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è —É –≤–∑—Ä–æ—Å–ª–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞?",
                        options: [
                            "120/80 –º–º —Ä—Ç.—Å—Ç.",
                            "140/90 –º–º —Ä—Ç.—Å—Ç.",
                            "100/60 –º–º —Ä—Ç.—Å—Ç.",
                            "130/85 –º–º —Ä—Ç.—Å—Ç."
                        ],
                        correct: 0,
                        time: 60
                    },
                    {
                        id: 'default2',
                        question: "–ö–∞–∫–æ–π –≤–∏—Ç–∞–º–∏–Ω –≤—ã—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –∫–æ–∂–µ –ø–æ–¥ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏–µ–º —Å–æ–ª–Ω–µ—á–Ω–æ–≥–æ —Å–≤–µ—Ç–∞?",
                        options: [
                            "–í–∏—Ç–∞–º–∏–Ω –ê",
                            "–í–∏—Ç–∞–º–∏–Ω –°",
                            "–í–∏—Ç–∞–º–∏–Ω D",
                            "–í–∏—Ç–∞–º–∏–Ω –ï"
                        ],
                        correct: 2,
                        time: 45
                    },
                    {
                        id: 'default3',
                        question: "–ö–∞–∫–æ–π –æ—Ä–≥–∞–Ω –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é –∫—Ä–æ–≤–∏ –∏ –≤—ã—Ä–∞–±–æ—Ç–∫—É –º–æ—á–∏?",
                        options: [
                            "–ü–µ—á–µ–Ω—å",
                            "–°–µ—Ä–¥—Ü–µ",
                            "–ü–æ—á–∫–∏",
                            "–õ–µ–≥–∫–∏–µ"
                        ],
                        correct: 2,
                        time: 75
                    }
                ];
            }

            // –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∞ (–±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ Firebase)
            let questions = [];
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            async function initAdminPanel() {
                try {
                    const [serverQuestions, serverSettings] = await Promise.all([
                        loadQuestions(),
                        loadSettings()
                    ]);
                    
                    questions = serverQuestions;
                    totalTime = serverSettings.totalTime * 60;
                    totalTimeInput.value = serverSettings.totalTime;
                    
                    renderQuestionsList();
                    
                    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤–∫–ª–∞–¥–æ–∫
                    tabs.forEach(tab => {
                        tab.addEventListener('click', function() {
                            const tabId = this.getAttribute('data-tab');
                            
                            tabs.forEach(t => t.classList.remove('active'));
                            this.classList.add('active');
                            
                            tabContents.forEach(content => {
                                content.classList.remove('active');
                                if (content.id === `${tabId}-tab`) {
                                    content.classList.add('active');
                                }
                            });
                        });
                    });
                    
                    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
                    addQuestionBtn.addEventListener('click', function() {
                        const newId = 'question_' + Date.now();
                        questions.push({
                            id: newId,
                            question: "–ù–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å",
                            options: ["–í–∞—Ä–∏–∞–Ω—Ç 1", "–í–∞—Ä–∏–∞–Ω—Ç 2", "–í–∞—Ä–∏–∞–Ω—Ç 3", "–í–∞—Ä–∏–∞–Ω—Ç 4"],
                            correct: 0,
                            time: 60
                        });
                        saveQuestionsToServer();
                        renderQuestionsList();
                    });
                    
                    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
                    saveSettingsBtn.addEventListener('click', saveSettingsToServer);
                    
                } catch (error) {
                    console.error('Error initializing admin panel:', error);
                }
            }

            async function saveQuestionsToServer() {
                try {
                    await saveQuestions(questions);
                    alert('‚úÖ –í–æ–ø—Ä–æ—Å—ã —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!');
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤: ' + error.message);
                }
            }

            async function saveSettingsToServer() {
                try {
                    const totalTimeMinutes = parseInt(totalTimeInput.value);
                    
                    if (totalTimeMinutes) {
                        await saveSettings({ totalTime: totalTimeMinutes });
                        totalTime = totalTimeMinutes * 60;
                        alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —É—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π!');
                    } else {
                        alert('‚ùå –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏.');
                    }
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫: ' + error.message);
                }
            }
            
            // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ —Å–ø–∏—Å–∫–∞ –≤–æ–ø—Ä–æ—Å–æ–≤ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            function renderQuestionsList() {
                questionsList.innerHTML = '';
                
                questions.forEach((question, index) => {
                    const questionItem = document.createElement('div');
                    questionItem.className = 'question-item';
                    questionItem.innerHTML = `
                        <div class="question-header">
                            <h3>–í–æ–ø—Ä–æ—Å ${index + 1} (–í—Ä–µ–º—è: ${question.time} —Å–µ–∫.)</h3>
                            <div class="question-actions">
                                <button class="btn btn-secondary edit-question" data-id="${question.id}">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                                <button class="btn btn-danger delete-question" data-id="${question.id}">–£–¥–∞–ª–∏—Ç—å</button>
                            </div>
                        </div>
                        <p>${question.question}</p>
                        <div class="options">
                            ${question.options.map((option, optIndex) => `
                                <div>${optIndex + 1}. ${option} ${optIndex === question.correct ? '(–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π)' : ''}</div>
                            `).join('')}
                        </div>
                    `;
                    
                    questionsList.appendChild(questionItem);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è
                document.querySelectorAll('.edit-question').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const questionId = this.getAttribute('data-id');
                        editQuestion(questionId);
                    });
                });
                
                document.querySelectorAll('.delete-question').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const questionId = this.getAttribute('data-id');
                        deleteQuestion(questionId);
                    });
                });
            }
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
            function editQuestion(questionId) {
                const question = questions.find(q => q.id === questionId);
                if (!question) return;
                
                const questionItem = document.querySelector(`.edit-question[data-id="${questionId}"]`).closest('.question-item');
                
                questionItem.innerHTML = `
                    <div class="form-group">
                        <label>–¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞</label>
                        <textarea class="question-text">${question.question}</textarea>
                    </div>
                    
                    <div class="form-group">
                        <label>–í—Ä–µ–º—è –Ω–∞ –≤–æ–ø—Ä–æ—Å (—Å–µ–∫—É–Ω–¥—ã)</label>
                        <input type="number" class="question-time" value="${question.time}" min="10">
                    </div>
                    
                    <div class="form-group">
                        <label>–í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤</label>
                        ${question.options.map((option, index) => `
                            <div class="option-input">
                                <input type="text" class="option-text" value="${option}" placeholder="–í–∞—Ä–∏–∞–Ω—Ç ${index + 1}">
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="correct-option">
                        <label>–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç:</label>
                        <select class="correct-answer">
                            ${question.options.map((_, index) => `
                                <option value="${index}" ${index === question.correct ? 'selected' : ''}>–í–∞—Ä–∏–∞–Ω—Ç ${index + 1}</option>
                            `).join('')}
                        </select>
                    </div>
                    
                    <div class="question-actions" style="margin-top: 15px;">
                        <button class="btn save-question" data-id="${questionId}">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="btn btn-secondary cancel-edit" data-id="${questionId}">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                `;
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ –æ—Ç–º–µ–Ω—ã
                questionItem.querySelector('.save-question').addEventListener('click', function() {
                    const updatedQuestion = questionItem.querySelector('.question-text').value;
                    const questionTime = parseInt(questionItem.querySelector('.question-time').value);
                    const optionInputs = questionItem.querySelectorAll('.option-text');
                    const correctAnswer = parseInt(questionItem.querySelector('.correct-answer').value);
                    
                    const updatedOptions = Array.from(optionInputs).map(input => input.value);
                    
                    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
                    question.question = updatedQuestion;
                    question.time = questionTime;
                    question.options = updatedOptions;
                    question.correct = correctAnswer;
                    
                    saveQuestionsToServer();
                    renderQuestionsList();
                });
                
                questionItem.querySelector('.cancel-edit').addEventListener('click', function() {
                    renderQuestionsList();
                });
            }
            
            // –£–¥–∞–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞
            function deleteQuestion(questionId) {
                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å?')) {
                    questions = questions.filter(q => q.id !== questionId);
                    saveQuestionsToServer();
                    renderQuestionsList();
                }
            }
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–∞
            async function initTest() {
                try {
                    const serverQuestions = await loadQuestions();
                    questions = serverQuestions;
                    
                    questionsContainer.innerHTML = '';
                    userAnswers = [];
                    currentQuestionIndex = 0;
                    questionTimers = [];
                    
                    // –°–æ–∑–¥–∞–µ–º —Ç–∞–π–º–µ—Ä—ã –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                    questions.forEach(question => {
                        questionTimers.push({
                            timeLeft: question.time,
                            timer: null
                        });
                    });
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å
                    showQuestion(currentQuestionIndex);
                    
                    // –ó–∞–ø—É—Å–∫–∞–µ–º –æ–±—â–∏–π —Ç–∞–π–º–µ—Ä
                    startTotalTimer();
                } catch (error) {
                    console.error('Error initializing test:', error);
                }
            }
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤–æ–ø—Ä–æ—Å
            function showQuestion(index) {
                questionsContainer.innerHTML = '';
                questionCounter.textContent = `–í–æ–ø—Ä–æ—Å ${index + 1} –∏–∑ ${questions.length}`;
                
                const question = questions[index];
                const questionElement = document.createElement('div');
                questionElement.className = 'question';
                
                const questionText = document.createElement('div');
                questionText.className = 'question-text';
                questionText.textContent = `${index + 1}. ${question.question}`;
                
                const questionTimer = document.createElement('div');
                questionTimer.className = 'question-timer';
                questionTimer.id = 'current-question-timer';
                questionTimer.textContent = `–í—Ä–µ–º—è –Ω–∞ –≤–æ–ø—Ä–æ—Å: ${formatTime(questionTimers[index].timeLeft)}`;
                
                const optionsContainer = document.createElement('div');
                optionsContainer.className = 'options';
                
                question.options.forEach((option, optionIndex) => {
                    const optionElement = document.createElement('label');
                    optionElement.className = 'option';
                    if (userAnswers[index] === optionIndex) {
                        optionElement.classList.add('selected');
                    }
                    
                    const radioInput = document.createElement('input');
                    radioInput.type = 'radio';
                    radioInput.name = `question-${index}`;
                    radioInput.value = optionIndex;
                    radioInput.checked = userAnswers[index] === optionIndex;
                    
                    radioInput.addEventListener('change', function() {
                        userAnswers[index] = optionIndex;
                        // –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                        const allOptions = optionsContainer.querySelectorAll('.option');
                        allOptions.forEach(opt => opt.classList.remove('selected'));
                        optionElement.classList.add('selected');
                        
                        // –†–∞–∑—Ä–µ—à–∞–µ–º –ø–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
                        if (index < questions.length - 1) {
                            nextQuestionBtn.disabled = false;
                        }
                    });
                    
                    const optionText = document.createElement('span');
                    optionText.textContent = option;
                    
                    optionElement.appendChild(radioInput);
                    optionElement.appendChild(optionText);
                    optionsContainer.appendChild(optionElement);
                });
                
                questionElement.appendChild(questionTimer);
                questionElement.appendChild(questionText);
                questionElement.appendChild(optionsContainer);
                questionsContainer.appendChild(questionElement);
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
                prevQuestionBtn.disabled = index === 0;
                nextQuestionBtn.disabled = index === questions.length - 1 || userAnswers[index] === undefined;
                
                // –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–∞–π–º–µ—Ä –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
                startQuestionTimer(index);
            }
            
            // –ó–∞–ø—É—Å–∫ –æ–±—â–µ–≥–æ —Ç–∞–π–º–µ—Ä–∞
            function startTotalTimer() {
                let timeLeft = totalTime;
                updateTimerDisplay(timeLeft);
                
                clearInterval(timerInterval);
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay(timeLeft);
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        timeExpired();
                    }
                }, 1000);
            }
            
            // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞
            function startQuestionTimer(questionIndex) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç–∞–π–º–µ—Ä –≤–æ–ø—Ä–æ—Å–∞
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                const questionTimer = questionTimers[questionIndex];
                const questionTime = questions[questionIndex].time;
                
                // –ï—Å–ª–∏ –≤—Ä–µ–º—è —É–∂–µ –∏—Å—Ç–µ–∫–ª–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
                if (questionTimer.timeLeft <= 0) {
                    if (questionIndex < questions.length - 1) {
                        nextQuestion();
                    } else {
                        submitTest();
                    }
                    return;
                }
                
                currentQuestionTimer = setInterval(() => {
                    questionTimer.timeLeft--;
                    updateQuestionTimerDisplay(questionTimer.timeLeft);
                    
                    if (questionTimer.timeLeft <= 0) {
                        clearInterval(currentQuestionTimer);
                        // –ï—Å–ª–∏ –≤—Ä–µ–º—è –∏—Å—Ç–µ–∫–ª–æ, –ø–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
                        if (questionIndex < questions.length - 1) {
                            nextQuestion();
                        } else {
                            submitTest();
                        }
                    }
                }, 1000);
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –æ–±—â–µ–≥–æ —Ç–∞–π–º–µ—Ä–∞
            function updateTimerDisplay(seconds) {
                timerElement.textContent = `–û–±—â–µ–µ –≤—Ä–µ–º—è: ${formatTime(seconds)}`;
                
                if (seconds <= 300) { // 5 –º–∏–Ω—É—Ç
                    timerElement.classList.add('warning');
                } else {
                    timerElement.classList.remove('warning');
                }
            }
            
            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∞–π–º–µ—Ä–∞ –≤–æ–ø—Ä–æ—Å–∞
            function updateQuestionTimerDisplay(seconds) {
                const questionTimer = document.getElementById('current-question-timer');
                if (questionTimer) {
                    questionTimer.textContent = `–í—Ä–µ–º—è –Ω–∞ –≤–æ–ø—Ä–æ—Å: ${formatTime(seconds)}`;
                    
                    if (seconds <= 10) {
                        questionTimer.style.color = '#d93025';
                    } else {
                        questionTimer.style.color = '#5f6368';
                    }
                }
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
            function nextQuestion() {
                if (currentQuestionIndex < questions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion(currentQuestionIndex);
                }
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
            function prevQuestion() {
                if (currentQuestionIndex > 0) {
                    currentQuestionIndex--;
                    showQuestion(currentQuestionIndex);
                }
            }
            
            // –ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è —Ç–µ—Å—Ç–∞
            function timeExpired() {
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ —Ç–∞–π–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤
                questionTimers.forEach(timer => {
                    if (timer.timer) {
                        clearInterval(timer.timer);
                    }
                });
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–∏
                const timeExpiredMsg = document.createElement('div');
                timeExpiredMsg.className = 'time-expired';
                timeExpiredMsg.innerHTML = `
                    <h3>–í—Ä–µ–º—è –≤—ã—à–ª–æ!</h3>
                    <p>–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤—ã –Ω–µ —É—Å–ø–µ–ª–∏ –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ—Å—Ç –≤ –æ—Ç–≤–µ–¥–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è.</p>
                    <p>–¢–µ—Å—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –ø—Ä–æ–≤–∞–ª–µ–Ω–Ω—ã–º.</p>
                `;
                
                testSection.insertBefore(timeExpiredMsg, testSection.firstChild);
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç —Å –ø—Ä–æ–≤–∞–ª—å–Ω—ã–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º
                setTimeout(() => {
                    submitTest(true);
                }, 3000);
            }
            
            // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
            function formatTime(seconds) {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            
            // –ü—Ä–æ–≤–µ—Ä–∫–∞ email
            function isValidEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email) && email.includes('gmail.com');
            }
            
            // –ù–∞—á–∞–ª–æ —Ç–µ—Å—Ç–∞
            startTestBtn.addEventListener('click', function() {
                const email = emailInput.value.trim();
                
                if (!isValidEmail(email)) {
                    emailError.classList.remove('hidden');
                    return;
                }
                
                emailError.classList.add('hidden');
                userEmail = email;
                userEmailElement.textContent = email;
                
                loginSection.classList.add('hidden');
                testSection.classList.remove('test-section');
                initTest();
            });
            
            // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
            function showDetailedResults(correctAnswers, answeredQuestions, timeExpired = false) {
                resultsSummary.innerHTML = '';
                resultsDetails.innerHTML = '';
                
                // –°–≤–æ–¥–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                resultsSummary.innerHTML = `
                    <div class="summary-item">
                        <div class="summary-value">${questions.length}</div>
                        <div class="summary-label">–í—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${answeredQuestions}</div>
                        <div class="summary-label">–û—Ç–≤–µ—á–µ–Ω–æ</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${correctAnswers}</div>
                        <div class="summary-label">–ü—Ä–∞–≤–∏–ª—å–Ω–æ</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${questions.length - answeredQuestions}</div>
                        <div class="summary-label">–ü—Ä–æ–ø—É—â–µ–Ω–æ</div>
                    </div>
                `;
                
                // –î–µ—Ç–∞–ª–∏ –ø–æ –∫–∞–∂–¥–æ–º—É –≤–æ–ø—Ä–æ—Å—É
                questions.forEach((question, index) => {
                    const resultItem = document.createElement('div');
                    const userAnswer = userAnswers[index];
                    const isCorrect = userAnswer === question.correct;
                    const isAnswered = userAnswer !== undefined;
                    
                    let statusClass = '';
                    let statusText = '';
                    
                    if (!isAnswered) {
                        statusClass = 'unanswered';
                        statusText = '–í–æ–ø—Ä–æ—Å –±–µ–∑ –æ—Ç–≤–µ—Ç–∞';
                    } else if (isCorrect) {
                        statusClass = 'correct';
                        statusText = '–ü—Ä–∞–≤–∏–ª—å–Ω–æ';
                    } else {
                        statusClass = 'incorrect';
                        statusText = '–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ';
                    }
                    
                    resultItem.className = `result-item ${statusClass}`;
                    resultItem.innerHTML = `
                        <div class="result-question">${index + 1}. ${question.question}</div>
                        <div class="result-answer">
                            <span class="user-answer">–í–∞—à –æ—Ç–≤–µ—Ç: </span>
                            ${isAnswered ? question.options[userAnswer] : '<span class="unanswered">–ù–µ –æ—Ç–≤–µ—Ç–∏–ª–∏</span>'}
                            ${!isAnswered ? '' : (isCorrect ? ' <span class="correct-answer">‚úì</span>' : ' <span class="incorrect-answer">‚úó</span>')}
                        </div>
                        ${!isCorrect && isAnswered ? `
                            <div class="result-answer">
                                <span class="correct-answer">–ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${question.options[question.correct]}</span>
                            </div>
                        ` : ''}
                        <div style="margin-top: 8px; font-size: 14px; color: #5f6368;">
                            ${statusText}
                        </div>
                    `;
                    
                    resultsDetails.appendChild(resultItem);
                });
            }
            
            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–µ—Å—Ç–∞
            function submitTest(timeExpired = false) {
                // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
                
                // –ü–æ–¥—Å—á–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                let correctAnswers = 0;
                let answeredQuestions = 0;
                
                userAnswers.forEach((answer, index) => {
                    if (answer !== undefined) {
                        answeredQuestions++;
                        if (answer === questions[index].correct) {
                            correctAnswers++;
                        }
                    }
                });
                
                const score = timeExpired ? 0 : Math.round((correctAnswers / questions.length) * 100);
                
                // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
                testSection.classList.add('test-section');
                resultsSection.classList.remove('test-section');
                
                scoreElement.textContent = `${score}%`;
                
                if (timeExpired) {
                    resultMessage.textContent = '–í—Ä–µ–º—è –≤—ã—à–ª–æ! –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω.';
                } else if (score >= 80) {
                    resultMessage.textContent = '–û—Ç–ª–∏—á–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í—ã –ø–æ–∫–∞–∑–∞–ª–∏ –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–Ω–∞–Ω–∏–π.';
                } else if (score >= 60) {
                    resultMessage.textContent = '–•–æ—Ä–æ—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç! –í–∞—à–∏ –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –∑–Ω–∞–Ω–∏—è –Ω–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–º —É—Ä–æ–≤–Ω–µ.';
                } else {
                    resultMessage.textContent = '–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏—Ö –∑–Ω–∞–Ω–∏–π.';
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
                showDetailedResults(correctAnswers, answeredQuestions, timeExpired);
                
                // –í —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—ã–ª –±—ã –∫–æ–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ email
                console.log(`–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ ${userEmail}: ${score}% –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤`);
            }
            
            submitTestBtn.addEventListener('click', () => submitTest());
            
            // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–∞
            restartTestBtn.addEventListener('click', function() {
                resultsSection.classList.add('test-section');
                loginSection.classList.remove('hidden');
                emailInput.value = '';
                
                // –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ç–∞–π–º–µ—Ä–æ–≤
                clearInterval(timerInterval);
                if (currentQuestionTimer) {
                    clearInterval(currentQuestionTimer);
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –ø–æ –≤–æ–ø—Ä–æ—Å–∞–º
            nextQuestionBtn.addEventListener('click', nextQuestion);
            prevQuestionBtn.addEventListener('click', prevQuestion);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É —Ä–µ–∂–∏–º–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
            adminToggle.addEventListener('click', function() {
                userPanel.style.display = 'none';
                adminPanel.style.display = 'block';
                adminLogin.classList.remove('hidden');
                adminContent.classList.add('hidden');
            });
            
            userModeBtn.addEventListener('click', function() {
                adminPanel.style.display = 'none';
                userPanel.style.display = 'block';
            });
            
            // –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
            adminLoginBtn.addEventListener('click', function() {
                const username = adminUsername.value.trim();
                const password = adminPassword.value.trim();
                
                if (username === adminCredentials.username && password === adminCredentials.password) {
                    adminLoginError.classList.add('hidden');
                    adminLogin.classList.add('hidden');
                    adminContent.classList.remove('hidden');
                    initAdminPanel();
                } else {
                    adminLoginError.classList.remove('hidden');
                }
            });
            
            // –í—ã—Ö–æ–¥ –∏–∑ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
            adminLogoutBtn.addEventListener('click', function() {
                adminLogin.classList.remove('hidden');
                adminContent.classList.add('hidden');
                adminUsername.value = '';
                adminPassword.value = '';
            });
        });
    </script>
</body>
</html>
